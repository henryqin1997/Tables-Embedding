{"relation": [["Rev", "[1]", "", "", "", "", "[201]", "[1]", "", "", "", "[6]", "[4]", "[8]", "[10]", "[52]", "[204]", "[256]", "[1]", "[190]", "", "", "[218]", "[190]", "", "[198]", "[190]", "[133]", "", "", "[2]", "[29]", "[210]", "[2]", "", "[1]", "", "[190]", "", "", "", "[198]", "[190]", "", "", "[196]", "[190]", "[196]", "", "", "[190]", "", "", "", "[198]", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "[190]", "", "", "", "", "", "", "", "", "", "", "", "", "", "[1]", "", "[6]", "[1]", "", "[199]", "[190]", "", "[191]", "[257]", "", "[190]", "", "[257]", "[199]", "[190]", "", "", "[261]", "[1]", "[261]", "", "[80]", "", "", "[259]", "[148]", "[5]", "[199]", "", "[133]", "[199]", "[210]", "[259]", "[210]", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "[199]", "", "[204]", "", "[231]", "[204]", "", "", "", "", "", "", "[256]", "", "", "", "", "", "", "", "[199]", "", "", "", "[204]", "", "[200]", "", "[199]", "", "[204]", "[199]", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "[210]", "[29]", "", "", "[5]", "", "[29]", "", "", "", "[198]", "", "", "", "[29]", "", "[1]", "", "", "[210]", "", "[1]", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "[29]", "", "", "[1]", "", "", "", "", "", "", "", "", "", "", "", "", "[6]", "[1]", "", "", "", "", "", "", "", "[6]", "[1]", "", "[6]", "", "[52]", "[79]", "[190]", "[218]", "[198]", "", "", "", "[1]", "", "", "", "", "", "", "", "", "[6]", "[1]", "[6]", "[1]", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "[62]", "", "[6]", "", "[1]", "", "", "", "", "", "", "", "", ""], ["Line", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "100", "101", "102", "103", "104", "105", "106", "107", "108", "109", "110", "111", "112", "113", "114", "115", "116", "117", "118", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "130", "131", "132", "133", "134", "135", "136", "137", "138", "139", "140", "141", "142", "143", "144", "145", "146", "147", "148", "149", "150", "151", "152", "153", "154", "155", "156", "157", "158", "159", "160", "161", "162", "163", "164", "165", "166", "167", "168", "169", "170", "171", "172", "173", "174", "175", "176", "177", "178", "179", "180", "181", "182", "183", "184", "185", "186", "187", "188", "189", "190", "191", "192", "193", "194", "195", "196", "197", "198", "199", "200", "201", "202", "203", "204", "205", "206", "207", "208", "209", "210", "211", "212", "213", "214", "215", "216", "217", "218", "219", "220", "221", "222", "223", "224", "225", "226", "227", "228", "229", "230", "231", "232", "233", "234", "235", "236", "237", "238", "239", "240", "241", "242", "243", "244", "245", "246", "247", "248", "249", "250", "251", "252", "253", "254", "255", "256", "257", "258", "259", "260", "261", "262", "263", "264", "265", "266", "267", "268", "269", "270", "271", "272", "273", "274", "275", "276", "277", "278", "279", "280", "281", "282", "283", "284", "285", "286", "287", "288", "289", "290", "291", "292", "293", "294", "295", "296", "297", "298", "299", "300", "301", "302", "303", "304", "305", "306", "307", "308", "309", "310", "311", "312", "313", "314", "315", "316", "317", "318", "319", "320", "321", "322", "323", "324", "325", "326", "327", "328", "329", "330", "331", "332", "333", "334", "335", "336", "337", "338", "339", "340", "341", "342", "343", "344", "345", "346", "347", "348", "349", "350", "351", "352", "353", "354", "355", "356", "357"], ["", "//", "// SapphireApplianceController.m", "// Sapphire", "//", "// Created by pnmerrill on 6/20/07.", "// Copyright 2007 www.nanopi.net. All rights reserved.", "//", "", "#import \"SapphireApplianceController.h\"", "#import", "#import \"SapphireBrowser.h\"", "#import \"SapphireMetaData.h\"", "#import \"SapphirePredicates.h\"", "#import \"SapphireSettings.h\"", "#import \"SapphireTheme.h\"", "#import \"SapphireTVDirectory.h\"", "#import \"SapphireMovieDirectory.h\"", "", "#import \"SapphireImporterDataMenu.h\"", "#import \"SapphireFileDataImporter.h\"", "#import \"SapphireTVShowImporter.h\"", "#import \"SapphireMovieImporter.h\"", "#import \"SapphireAllImporter.h\"", "", "#define BROWSER_MENU_ITEM BRLocalizedString(@\" Browse\", @\"Browser Menu Item\")", "#define ALL_IMPORT_MENU_ITEM BRLocalizedString(@\" Import All Data\", @\"All Importer Menu Item\")", "#define SETTINGS_MENU_ITEM BRLocalizedString(@\" Settings\", @\"Settings Menu Item\")", "#define RESET_MENU_ITEM BRLocalizedString(@\" Reset the thing already\", @\"UI Quit\")", "", "@interface SapphireApplianceController (private)", "- (void)setMenuFromSettings;", "- (void)recreateMenu;", "@end", "", "@implementation SapphireApplianceController", "", "static NSArray *predicates = nil;", "", "+ (void)initialize", "{", "predicates = [[NSArray alloc] initWithObjects:[[SapphireUnwatchedPredicate alloc] init], [[SapphireFavoritePredicate alloc] init], [[SapphireTopShowPredicate alloc] init], nil];", "[predicates makeObjectsPerformSelector:@selector(release)];", "}", "", "+ (SapphirePredicate *)predicate", "{", "SapphireSettings *settings = [SapphireSettings sharedSettings];", "int index = [settings indexOfLastPredicate];", "if(index == NSNotFound)", "return nil;", "return [predicates objectAtIndex:index];", "}", "", "+ (SapphirePredicate *)nextPredicate", "{", "SapphireSettings *settings = [SapphireSettings sharedSettings];", "int index = [settings indexOfLastPredicate];", "int newIndex;", "switch(index)", "{", "case NSNotFound:", "newIndex = 0;", "if([settings displayUnwatched])", "break;", "case 0:", "newIndex = 1;", "if([settings displayFavorites])", "break;", "case 1:", "newIndex = 2;", "if([settings displayTopShows])", "break;", "default:", "newIndex = NSNotFound;", "}", "[settings setIndexOfLastPredicate:newIndex];", "if(newIndex == NSNotFound)", "return nil;", "return [predicates objectAtIndex:newIndex];", "}", "", "+ (BRTexture *)gemForPredicate:(SapphirePredicate *)predicate", "{", "SapphireTheme *theme = [SapphireTheme sharedTheme];", "if(predicate == nil)", "return [theme gem:RED_GEM_KEY];", "if([predicate isKindOfClass:[SapphireUnwatchedPredicate class]])", "return [theme gem:BLUE_GEM_KEY];", "if([predicate isKindOfClass:[SapphireFavoritePredicate class]])", "return [theme gem:YELLOW_GEM_KEY];", "if([predicate isKindOfClass:[SapphireTopShowPredicate class]])", "return [theme gem:GREEN_GEM_KEY];", "return nil;", "}", "", "+ (NSString *) rootMenuLabel", "{", "return (@\"net.pmerrill.Sapphire\" );", "}", "", "- (SapphireImporterDataMenu *)allImporterForCollection:(SapphireMetaDataCollection *)collection", "{", "SapphireFileDataImporter *fileImp = [[SapphireFileDataImporter alloc] init];", "SapphireTVShowImporter *tvImp = [[SapphireTVShowImporter alloc] initWithSavedSetting:[NSHomeDirectory() stringByAppendingPathComponent:@\"Library/Application Support/Sapphire/tvdata.plist\"]];", "// SapphireMovieImporter *movImp = [[SapphireMovieImporter alloc] initWithSavedSetting:[NSHomeDirectory() stringByAppendingPathComponent:@\"Library/Application Support/Sapphire/movieData.plist\"]];", "SapphireAllImporter *allImp = [[SapphireAllImporter alloc] initWithImporters:[NSArray arrayWithObjects:fileImp, tvImp,nil]];", "[fileImp release];", "[tvImp release];", "// [movImp release];", "SapphireImporterDataMenu *ret = [[SapphireImporterDataMenu alloc] initWithScene:[self scene] metaDataCollection:collection importer:allImp];", "return [ret autorelease];", "}", "", "- (id) initWithScene: (BRRenderScene *) scene", "{", "self = [super initWithScene:scene];", "", "//Setup the theme's scene", "SapphireTheme *theme = [SapphireTheme sharedTheme];", "[theme setScene:[self scene]];", "", "metaCollection = [[SapphireMetaDataCollection alloc] initWithFile:[NSHomeDirectory() stringByAppendingPathComponent:@\"Library/Application Support/Sapphire/metaData.plist\"]];", "", "settings = [[SapphireSettings alloc] initWithScene:[self scene] settingsPath:[NSHomeDirectory() stringByAppendingPathComponent:@\"Library/Application Support/Sapphire/settings.plist\"] metaDataCollection:metaCollection] ;", "[self setListTitle: BRLocalizedString(@\"Main Menu\", @\"\")];", "[settings setListTitle: BRLocalizedString(@\"Settings\", @\"Settings Menu Item\")] ;", "[settings setListIcon: [theme gem:GEAR_GEM_KEY]];", "[[self list] setDatasource:self];", "", "return self;", "}", "", "- (void)dealloc", "{", "[names release];", "[controllers release];", "[masterNames release];", "[masterControllers release];", "[metaCollection release];", "[SapphireSettings relinquishSettings];", "[settings release];", "[super dealloc];", "}", "", "- (void)recreateMenu", "{", "SapphireImporterDataMenu *allImporter = [self allImporterForCollection:metaCollection];", "NSMutableArray *mutableMasterNames = [[NSMutableArray alloc] init];", "NSMutableArray *mutableMasterControllers = [[NSMutableArray alloc] init];", "BRTexture *predicateGem = [SapphireApplianceController gemForPredicate:[SapphireApplianceController predicate]];", "", "SapphireTVDirectory *tvDir = [[SapphireTVDirectory alloc] initWithCollection:metaCollection];", "SapphireBrowser *tvBrowser = [[SapphireBrowser alloc] initWithScene:[self scene] metaData:tvDir];", "[tvBrowser setListTitle:BRLocalizedString(@\"TV Shows\", nil)];", "[tvBrowser setListIcon:predicateGem];", "[mutableMasterNames addObject:BRLocalizedString(@\" TV Shows\", nil)];", "[mutableMasterControllers addObject:tvBrowser];", "[tvBrowser release];", "", "SapphireMovieDirectory *movieDir = [[SapphireMovieDirectory alloc] initWithCollection:metaCollection];", "SapphireBrowser *movieBrowser = [[SapphireBrowser alloc] initWithScene:[self scene] metaData:movieDir];", "[movieBrowser setListTitle:BRLocalizedString(@\"Movies\", nil)];", "[movieBrowser setListIcon:predicateGem];", "[mutableMasterNames addObject:BRLocalizedString(@\" Movies\", nil)];", "[mutableMasterControllers addObject:movieBrowser];", "[movieBrowser release];", "", "NSEnumerator *browserPointsEnum = [[metaCollection collectionDirectories] objectEnumerator];", "NSString *browserPoint = nil;", "while((browserPoint = [browserPointsEnum nextObject]) != nil)", "{", "if(![metaCollection skipCollection:browserPoint])", "[[metaCollection directoryForPath:browserPoint] loadMetaData];", "if([metaCollection hideCollection:browserPoint])", "continue;", "SapphireBrowser *browser = [[SapphireBrowser alloc] initWithScene:[self scene] metaData:[metaCollection directoryForPath:browserPoint]];", "[browser setListTitle:[browserPoint lastPathComponent]];", "[browser setListIcon:predicateGem];", "[mutableMasterNames addObject:[NSString stringWithFormat:@\" %@\", browserPoint]];", "[mutableMasterControllers addObject:browser];", "[browser release];", "}", "[mutableMasterNames addObjectsFromArray:[NSArray arrayWithObjects:", "ALL_IMPORT_MENU_ITEM,", "SETTINGS_MENU_ITEM,", "RESET_MENU_ITEM,", "nil]];", "[mutableMasterControllers addObjectsFromArray:[NSArray arrayWithObjects:", "allImporter,", "settings,", "nil]];", "masterNames = [[NSArray alloc] initWithArray:mutableMasterNames];", "masterControllers = [[NSArray alloc] initWithArray:mutableMasterControllers];", "[mutableMasterNames release];", "[mutableMasterControllers release];", "", "names = [[NSMutableArray alloc] init];", "controllers = [[NSMutableArray alloc] init];", "[self setMenuFromSettings];", "}", "", "- (void)setMenuFromSettings", "{", "[names removeAllObjects];", "[controllers removeAllObjects];", "[names addObjectsFromArray:masterNames];", "[controllers addObjectsFromArray:masterControllers];", "if([settings disableUIQuit])", "[names removeLastObject];", "}", "", "- (void) willBePushed", "{", "// We're about to be placed on screen, but we're not yet there", "[self recreateMenu];", "[[self list] reload];", "// always call super", "[super willBePushed];", "}", "", "- (void) wasPushed", "{", "// We've just been put on screen, the user can see this controller's content now", "", "// always call super", "[super wasPushed];", "}", "", "- (void) willBePopped", "{", "// The user pressed Menu, but we've not been removed from the screen yet", "", "// always call super", "[super willBePopped];", "}", "", "- (void) wasPopped", "{", "// The user pressed Menu, removing us from the screen", "", "// always call super", "[super wasPopped];", "}", "", "- (void) willBeBuried", "{", "// The user just chose an option, and we will be taken off the screen", "", "// always call super", "[super willBeBuried];", "}", "", "- (void) wasBuriedByPushingController: (BRLayerController *) controller", "{", "// The user chose an option and this controller os no longer on screen", "", "// always call super", "[super wasBuriedByPushingController: controller];", "}", "", "- (void) willBeExhumed", "{", "// the user pressed Menu, but we've not been revealed yet", "", "// always call super", "[super willBeExhumed];", "[self setMenuFromSettings];", "[[self list] reload];", "[[self scene] renderScene];", "}", "", "- (void) wasExhumedByPoppingController: (BRLayerController *) controller", "{", "// handle being revealed when the user presses Menu", "", "// always call super", "[super wasExhumedByPoppingController: controller];", "}", "", "- (long) itemCount", "{", "// return the number of items in your menu list here", "return ( [ names count]);", "}", "", "- (id) itemForRow: (long) row", "{", "/*", "// build a BRTextMenuItemLayer or a BRAdornedMenuItemLayer, etc. here", "// return that object, it will be used to display the list item.", "*/", "if( row > [names count] ) return ( nil ) ;", "", "BRAdornedMenuItemLayer * result = nil ;", "NSString *name = [names objectAtIndex:row];", "result = [BRAdornedMenuItemLayer adornedFolderMenuItemWithScene: [self scene]] ;", "", "SapphireTheme *theme = [SapphireTheme sharedTheme];", "if([name isEqual: ALL_IMPORT_MENU_ITEM]) [result setLeftIcon:[theme gem:GEAR_GEM_KEY]];", "// else if([name isEqual: AGENT_IMPORT_MENU_ITEM]) [result setLeftIcon:[theme gem:GEAR_GEM_KEY]];", "else if([name isEqual: SETTINGS_MENU_ITEM]) [result setLeftIcon:[theme gem:GEAR_GEM_KEY]];", "else if([name isEqual: RESET_MENU_ITEM]) [result setLeftIcon:[theme gem:CONE_GEM_KEY]];", "else [result setLeftIcon:[SapphireApplianceController gemForPredicate:[SapphireApplianceController predicate]]];", "", "// add text", "[[result textItem] setTitle: name] ;", "", "return ( result ) ;", "}", "", "- (NSString *) titleForRow: (long) row", "{", "", "if ( row > [ names count] ) return ( nil );", "", "NSString *result = [ names objectAtIndex: row] ;", "return ( result ) ;", "/*", "// return the title for the list item at the given index here", "return ( @\"Sapphire\" );", "*/", "}", "", "- (long) rowForTitle: (NSString *) title", "{", "long result = -1;", "long i, count = [self itemCount];", "for ( i = 0; i < count; i++ )", "{", "if ( [title isEqualToString: [self titleForRow: i]] )", "{", "result = i;", "break;", "}", "}", "", "return ( result );", "}", "", "- (void) itemSelected: (long) row", "{", "// This is called when the user presses play/pause on a list item", "", "if(row == [controllers count])", "[[NSApplication sharedApplication] terminate:self];", "id controller = [controllers objectAtIndex:row];", "[[self stack] pushController:controller];", "}", "", "- (id) previewControllerForItem: (long) item", "{", "// If subclassing BRMediaMenuController, this function is called when the selection cursor", "// passes over an item.", "return ( nil );", "}", "", "@end"]], "pageTitle": "SapphireApplianceController.m in trunk \u2013 Sapphire", "title": "", "url": "http://appletv.nanopi.net/trac/browser/trunk/SapphireApplianceController.m?annotate=blame&rev=261", "hasHeader": true, "headerPosition": "MIXED", "tableType": "RELATION", "tableNum": 1, "s3Link": "common-crawl/crawl-data/CC-MAIN-2015-32/segments/1438044160065.87/warc/CC-MAIN-20150728004240-00312-ip-10-236-191-2.ec2.internal.warc.gz", "recordEndOffset": 10012496, "recordOffset": 9996569, "tableOrientation": "HORIZONTAL", "textBeforeTable": "Get around the undefined initWithScene and scene selectors. Revision 261, 11.1 KB checked in by gbooker, 8 years ago (diff) trunk Visit: View revision: source: trunk/SapphireApplianceController.m @ 261 Revision Log Normal Next Revision \u2192 Latest Revision \u2190 Previous Revision Context Navigation Search View Tickets Browse Source Roadmap Timeline Wiki About Trac Help/Guide Preferences Login Search:", "textAfterTable": "Note: See TracBrowser for help on using the repository browser. Download in other formats: Plain Text Original Format Powered by Trac 0.12.2 By Edgewall Software. Visit the Trac open source project at http://trac.edgewall.com/", "hasKeyColumn": false, "keyColumnIndex": -1, "headerRowIndex": 0}