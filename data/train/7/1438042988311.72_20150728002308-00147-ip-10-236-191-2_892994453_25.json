{
    "relation": [
        [
            "Protocol",
            "SMB",
            "ICMP",
            "UDP",
            "NBT",
            "TCP",
            "MSRPC",
            "LDAP",
            "Kerberos"
        ],
        [
            "Frames",
            "16",
            "4",
            "12",
            "17",
            "86",
            "16",
            "4",
            "12"
        ],
        [
            "Bytes Claimed",
            "3070",
            "114",
            "96",
            "1164",
            "6019",
            "3872",
            "3226",
            "14229"
        ]
    ],
    "pageTitle": "Windows 2000 Startup and Logon Traffic Analysis",
    "title": "",
    "url": "https://technet.microsoft.com/en-us/library/bb742590.aspx",
    "hasHeader": true,
    "headerPosition": "FIRST_ROW",
    "tableType": "RELATION",
    "tableNum": 25,
    "s3Link": "common-crawl/crawl-data/CC-MAIN-2015-32/segments/1438042988311.72/warc/CC-MAIN-20150728002308-00147-ip-10-236-191-2.ec2.internal.warc.gz",
    "recordEndOffset": 893038543,
    "recordOffset": 892994453,
    "tableOrientation": "HORIZONTAL",
    "TableContextTimeStampAfterTable": "{163386=1 upgraded Windows 2000 domain controller running DNS DHCP WINS 1 NT 4.0 SP6a BDC, 109707=After the secure channel has been established, the client will retrieve all necessary tickets to establish an IPC$ session with the controller. Because all Windows 2000 domain controllers are Kerberos Key Distribution Center (KDC), the client tries to detect the closest KDC in the same way it has already done it for the LDAP services., 125001=The client then requests information from the LDAP RootDSE. The RootDSE is a standard attribute defined in the LDAP 3.0 specification. The RootDSE contains information about the directory server, including its capabilities and configuration. The search response will contain a standard set of information as defined in RFC 2251. One of the items returned with this response is the supported Simple Authentication and Security Layer (SASL) mechanism. In this case it returns GSS-SPNEGO., 161440=We have now provided a detailed examination of the Windows 2000 computer startup and user logon process. As stated in the introduction, understanding this process will assist with both infrastructure design and systems administration in Windows 2000 networks., 75020=Note: Operations Masters are described in Chapter 7 of the Distributed Systems Guide in the Windows 2000 Server Resource Kit., 89675=The DNS query above shows the client looking for the LDAP Service in the \"Default-First-Site-Name.\" Default-First-Site-Name is the default name given to a Windows 2000 domain site when it is created., 176005=UDP Port 1505 - funkproxy, 162832=Windows 2000, 61927=Windows 2000 Resource Kit, 172625=1863, 65034=The Common Internet File System is the standard way that computer users share files across corporate intranets and the Internet in a Windows network. The CIFS is an enhanced version of the SMB protocol. CIFS is an open, cross-platform implementation of SMB that is currently a draft Internet standard. CIFS was introduced in Service Part 3 for Windows NT 4.0 and is the native file sharing protocol for Windows 2000. The CIFS is a variant of the NTLM 0.12 protocol., 130348=.A..S., len: 0, seq:3068641675- 3068641675, ack: 978497640, win:17520, src: 389 dst: 1050, 106195=c/o RPC Bind: UUID 12345678-1234- ABCD-EF0, 53674=RFC: 1035, 1036, 66925=The SMB/CIFS Process in Windows 2000, 46082=The Windows 2000 Resource Kit, Microsoft TechNet, and the Notes from the Field series offer more detailed discussions of core Windows 2000 services we will discuss as part of the client startup and logon process. It would be worthwhile to have access to these resources as supplementary resources while reading this paper., 43968=In addition to discussing the Windows 2000 core components used by the startup and logon process, the paper shows what happens and how much network traffic is generated during each part of the process. The discussion begins with an overview of the Windows 2000 components involved in the startup and logon process. We will then examine the Client Startup process and discuss the User logon process., 185232=TCP Port 1502 - shivadiscovery, 171738=1646, 73172=The Windows 2000 startup and logon process uses the Netlogon and the Directory Replication Service (DRS) interface. The Netlogon interface is used to establish the secure communications channel between the client and a domain controller in a domain. The Directory Replication Service is primarily used for communication between Domain Controllers and Global Catalog servers. It does, however, provide an interface used during the logon process. The DRS provides a method to convert names into a format that is useable by LDAP., 162874=1 Windows 2000 domain controller in Domain Main.Local running DNS DHCP WINS, 59283=An LDAP referral is a domain controller's way of indicating to a client application that it does not have a copy of a requested object (or, more precisely, that it does not hold the section of the directory tree where that object would be, if in fact it exists) and giving the client a location that is more likely to hold the object, which the client uses as the basis for a DNS search for a domain controller. Ideally, referrals always reference a domain controller that indeed holds the object. However, it is possible for the referred-to domain controller to generate yet another referral, although it usually does not take long to discover that the object does not exist and to inform the client. Active Directory returns referrals in accordance with RFC 2251., 130059=....S., len: 0, seq: 978497639- 978497639, ack: 0, win:16384, src: 1050 dst: 389, 172919=2105, 46645=In order to understand the Windows 2000 client startup and logon process, a discussion of the new or updated protocols and services that play a role in this process is needed. This section provides a brief overview of each of the following protocols and services involved:, 68493=Windows 2000 TCP/IP Protocols and Services Technical Reference, 118352=Echo: From 10.00.00.100 To 10.00.00.22, 42522=The client startup and logon process is the process the Microsoft Windows operating systems uses to validate a computer or User in the Windows networking environment. Developing an understanding of the client startup and user logon process is fundamental to understanding Windows 2000 networking. This white paper will provide the reader with detailed information on this process, including:, 87457=The Windows 2000 domain is an administrative boundary, which is independent from the structure of a given network. The computer in a given environment can be grouped into sites. A site in Windows 2000 is defined as a set of IP subnets connected by fast, reliable connectivity. As a rule of thumb, networks with LAN speed or better are considered fast networks for the purposes of defining a site. A domain can span multiple sites and multiple domains can cover a site., 160429=1164, 118589=Echo Reply: To 10.00.00.100 From 10.00.00.22, 78603=The objective of the following sections is to describe the steps that are involved in the Windows 2000 startup and logon process. The NetBIOS over TCP/IP functionality is disabled on all computers to set the focus on network traffic that occurs in an environment that has only Windows 2000 computers., 64639=The SMB protocol has gone through many revisions over time. The most current version of SMB implemented in Windows 2000 is the Common Internet File System (CIFS), which is a slight variant of the NT LM 0.12 version used previously. The next section goes into the details of this modern implementation., 130646=.A...., len: 0, seq: 978497640- 978497640, ack:3068641676, win:17520, src: 1050 dst: 389, 75368=RFC: 1769, 2030, 172329=1812, 56837=Lightweight Directory Access Protocol is a Directory Access Protocol (DAP) designed to allow clients to query, create, update, and delete information stored in a directory. It was initially used as a front-end to X.500 directories, but can also be used with stand-alone directory servers. Windows 2000 supports both LDAP version 3 and version 2., 150570=Windows 2000 provides three ways for a user to enter account information at logon. The first method is to use the Security Accounts Manager (SAM) account name and select the domain. This is the default method for logon. The second method is to use the fully qualified name, which would appear as <user>@<domain-org-company-com>. The third alternative is use the User Principle Name (UPN), which is described in the Windows 2000 Resource Kit as follows:, 67381=In Windows NT 4.0, Windows Internet Name Service (WINS), and Domain Name System (DNS), name resolution was accomplished by using TCP port 134. Extensions to CIFS and NetBT now allow connections directly over TCP/IP with the use of TCP port 445. Both means of resolution are still available in Windows 2000. It is possible to disable either or both of these services in the registry., 43151=How Windows 2000 clients use the Dynamic Domain Naming System (DDNS) support in Windows 2000 to locate domain controllers and other servers in the infrastructure needed during startup and logon. In addition we will show how Windows 2000 clients register their names in DDNS., 45585=The target groups for this discussion are systems administrators and network architects who are planning, implementing, or managing Windows 2000 networks. It is expected that this group will have an understanding of the following topics:, 45111=Reading and understanding this white paper will allow systems architects and administrators to better engineer and support Windows 2000 networks. It should help network designers determine where to place key components to ensure reliable startup and logon in a Windows 2000 network. Support professionals will be able to use this paper to resolve problems by comparing the baseline information provided here to their environments., 69717=The RPC procedures are uniquely identified by an interface number (UUID), an operation number (opnum), and a version number. The interface number identifies a group of related remote procedures. An example for an interface is net logon, which has the UUID 12345678-1234-ABCD-EF00-01234567CFFB., 145838=0x6:Dyn Upd Resp. PRE/UPD records to 24.0.0.10.in-addr.arpa, 102728=More details about the domain locator process can be found in the chapter \"Name Resolution in Active Directory\" of the Windows 2000 Resource Kit., 86228=In a Windows 2000 domain, each controller is also an LDAP server. In order to retrieve a list of available controllers, the client can query the DNS for SRV resource records with the name _ldap._tcp.dc._msdcs.DnsDomanName ., 66614=In Windows 2000, CIFS supports distributed replicated virtual volumes (such as Distributed File System [DFS]), file and record locking, file change notification, read-ahead and write-behind operations. CIFS communications are established via standard SMB session and name resolution mechanisms., 163650=1 Windows 2000 Server Domain Controller in Domain Corp.Main.Local running: DNS DHCP 2 Windows 2000 Servers configured as RRAS routers using a Null Modem Cable to simulate a slow link 1 Windows 2000 Domain Controller in Domain Field.Main.Local 1 Windows 2000 Domain Controller in Domain Field.Main.Local running: DNS (Secondary) DHCP, 53454=Windows 2000 Resource Kit: Name Resolution in Active Directory, Distributed Systems Guide, 52033=The primary mechanism for service location and name resolution in Windows 2000 is the Domain Name System (DNS). Windows 2000 includes a DNS system that is tightly integrated with the operating system providing integration with the Active Directory and support for making Dynamic updates, but any BIND 8.2.2 compliant DNS can be used with Windows 2000. DNS support in Windows 2000 is intended as a standards-based replacement for the NetBIOS-based Windows Internet Naming Service (WINS), which was the previous service that provided dynamic support for Windows clients. Both services provide the ability for dynamic updating of system names into their databases but WINS is a flat-name space and does not scale as well as DNS. By moving to DNS, Windows 2000 not only conforms to Internet standards, it provides a hierarchical naming system that scales to meet the demands of large networks., 62127=RFCs 2251-2256, 131699=.AP..., len: 171, seq:3068642008- 3068642179, ack: 978499062, win:16098, src: 389 dst: 1050, 131399=.AP..., len: 129, seq: 978498933- 978499062, ack:3068642008, win:17188, src: 1050 dst: 389, 145581=0x6:Dyn Upd PRE/UPD records to 24.0.0.10.in- addr.arpa, 175841=TCP Port 1505 - funkproxy, 132901=.AP..., len: 1273, seq:3068557193- 3068558466, ack: 978423674, win:17520, src: 389 dst: 1048, 45859=Microsoft Windows NT or 2000 networking concepts, 172054=1755, 171444=1433, 180268=UDP Port 1525 - prospero-np, 53771=Kerberos V5 is the default authentication protocol in Windows 2000. Kerberos originated as part of Project Athena at MIT in the late 1980s, and version 5 is described in the IETF RFC 1510., 145329=0x5:Std Qry Resp. for 0.0.10.in-addr.arpa. of type SOA, 79744=A computer that is a member of a Windows 2000 domain goes through a startup process that connects it to the domain it is a member of. This startup process allows services on the computer to interact or be interacted with on the network, and more importantly, it is required in order for users to interactively log on. This process flow shows the computer startup process., 133079=After the client determines what policies are applicable, it makes a second DFS referral. This will occur ahead of most attempts by a client in Windows 2000 to connect to a share point., 49968=RFC 2131, 67868=The Windows 2000 client startup and logon process uses SMB to load Group Policy objects applicable to that workstation or user. The basic SMB operation that is observed during the startup and logon process is SMB dialect negotiation. This is an exchange between the client and the server to determine which SMB dialect they will be able to use. SMB will also be used to make a DFS referral for the share that is being accessed. The client loading Group Policy objects will create the majority of SMB traffic during the startup and logon process., 132601=.AP..., len: 467, seq: 978423207- 978423674, ack:3068557193, win:16775, src: 1048 dst: 389, 171884=1723, 179065=TCP Port 1512 - wins, 64957=Windows 2000 support for SMB via the CIFS, 145073=DNS 0x5:Std Qry for 0.0.10.in- addr.arpa. of type SOA, 184894=TCP Port 1723 - PPTP, 60823=LDAP message PDUs (Protocol Data Units) are mapped directly onto the TCP byte stream. RFC 2251 recommends that server implementations provide a protocol listener on the assigned port, 389. The Active Directory uses port 389 as the default port for domain controller communications. In addition, the Active Directory supports port 636 for LDAP Secure Sockets Layer (SSL) communications. A Windows 2000 domain controller that is a Global Catalog (GC) server will listen on port 3268 for LDAP communications and port 3269 for LDAP SSL communications., 56550=For more information about Kerberos on Windows 2000, see http://www.microsoft.com/windows2000/techinfo/howitworks/security/kerberos.asp., 44856=Microsoft Windows 2000 Resource Kits, 172767=2053, 115227=The client then makes a Distributed File System (DFS) referral. A DFS referral is the DFS client-server protocol to get DFS-specific information that exists on the server to the client. It occurs whenever necessary. The general referral process is started when the client sends an SMB packet, indicating it is a DFS referral. The server passes this request to the DFS driver to complete the request. Subsequently, any access to network shares could result in a DFS referral request, if the client does not already have information about that share. Windows 2000 is a DFS version 5.0 client. This version allows caching of referrals to a DFS root or link for a (administrator configurable) specific length of time., 129760=AP..., len: 294, seq:3068556899- 3068557193, ack: 978423207, win:16081, src: 389 dst: 1048, 162994=1 Windows 2000 Professional Desktop 1 Windows 2000 Professional Notebook, 62059=RFCs 1777, 1778, 1779, 1959, 1960, 1823, 75421=Windows 2000 Domain Authentication Methods, 132300=.AP..., len: 201, seq:3068642179- 3068642380, ack: 978499265, win:17520, src: 389 dst: 1050, 76635=To provide legacy support, Windows 2000 continues to provide support for NTLM authentication. Windows 2000 will use NTLM for authentication when not in a Windows 2000 domain, as a member of a NT 4 domain or workgroup, or when there is a need to access older applications that require NTLM for authentication., 162512=The following system configurations were used to validate the Windows 2000 startup and logon process., 49931=RFC 1541, 163254=1 Windows 2000 Professional Desktop, 52939=The Windows 2000 startup and logon process uses DNS to locate services like LDAP and Kerberos to retrieve the address of at least one controller and to register its hostname and IP address in DNS zone database., 171588=1645, 179247=UDP Port 1512 - wins, 132000=.AP..., len: 203, seq: 978499062- 978499265, ack:3068642179, win:17017, src: 1050 dst: 389, 129461=.AP..., len: 173, seq: 978423034- 978423207, ack:3068556899, win:17069, src: 1048 dst: 389, 53166=The Windows 2000 DNS system and its requirements are covered in great detail in the Windows 2000 Resource Kit and the Notes from the Field book Building Enterprise Active Directory Services., 108820=Important: When an environment is mixed after an upgrade of a Windows NT 4 domain to Windows 2000, it is important to be aware of the following situation. When the only available domain controller for a Windows 2000 client to authenticate with is a Windows NT 4.0 backup domain controller, it will be unable to establish a secure channel. This is by design to increase security. Windows 2000 clients know what type of domain they belong to and will not downgrade their authentication method when setting a secure channel. The following trace sequence shows this scenario. It appears to be identical to the Windows 2000 client in a Windows NT 4.0 domain. The main appears after this because the client was unable to setup a secure channel, thus domain authentication fails., 99719=ICMP Echo: From 10.00.00.24 To 10.00.00.22, 172479=1813, 75793=The default authentication protocol in Windows 2000 is based on MIT's Kerberos version 5, outlined in RFC 1510. Using Kerberos for authentication fundamentally changes the way security information is exchanged between clients, servers, and domain controllers in the Windows network., 180085=TCP Port 1525 - prospero-np, 61981=Windows 2000 Active Directory Technical Reference, 116267=The first two requests serve to initialize the DFS client. The first is used to learn the names of all trusted Windows 2000 domains that could be the accessed by the client. The second is used to obtain a list of domain controller in the domain order by local site first. The names returned contain both the Netbios name and DNS names of the domains., 75499=Windows 2000 supports two different authentication methods for domain logons: Kerberos and NTLM. The use of Kerberos as the authentication protocol for Windows 2000 changes the default Windows authentication protocol from NTLM to a protocol that is based on Internet Standards., 48990=DHCPInform. This is a new message defined in Request for Comments (RFC) 2131. If a client has already obtained an Internet Protocol (IP) address (for example, manual configuration), it may use this message to retrieve additional configuration parameters that are related to the IP address from a DHCP server., 74134=Windows 2000 includes the W32Time (Windows Time) time service that provides a mechanism for synchronizing system time between Windows 2000 clients in a domain. Time synchronization occurs during the computer startup process., 171298=1109, 65516=Windows 2000 SMB/CIFS Protocol Implementation, 164578=All network tests and configurations discussed in this document use the TCP/IP transport protocol. TCP/IP is the default network protocol for Windows 2000 and many of the services that logon and startup use require TCP/IP., 58143=Windows 2000 supports the LDAPv3 protocol as defined in RFC 2251. Key aspects of the protocol are:, 50209=Windows 2000 implements the Automatic Private IP Addressing (APIPA), which will provide an IP address to a DHCP client even if there is no DHCP server available. APIPA is designed for computers on single-subnet networks that do not include a DHCP server. APIPA automatically assigns an IP address from its reserved range, 169.254.0.01 through 169.254.255.254. What this means is that when a client fails to communicate with a local DHCP server at startup to renew its lease, it will use an APIPA assigned address until it can communicate with a DHCP server. This is different behavior from Windows NT 4.0 where the client would continue to lease a lease that had not expired even if the client could no longer contact the DHCP server., 103401=The process starts with a negotiation of the SMB dialect both parties will use. The SMB protocol has undergone many revisions and extensions since its release in 1984. This means the client and the server may not necessarily be using the same SMB dialect. In this case, both sides are Windows 2000, which uses the dialect NTLM 0.12. This dialect allows exchanges to use Unicode. Prior to this, exchanges were made in ASCII. The benefit of Unicode strings is they can include file names, resource names, and user names., 164047=1 Windows 2000 Professional Desktop in Domain Corp.Main.Local 1 Windows 2000 Professional Desktop in Domain Field.Main.Local, 185388=UDP Port 1502 - shivadiscovery, 50005=Dynamic Host Configuration Protocol, TCP/IP Core Networking Guide, Windows 2000 Server Resource Kit, 77376=Windows 2000 Resource Kit: Authentication; Distributed Systems Guide, 41621=Introduction Windows 2000 Component Overview Description of the Windows 2000 Startup and Logon Process User Logon Conclusion Appendix A: Test Environment Appendix B: TCP/IP Ports Used in the Authentication Process, 61464=LDAP is used extensively during the Windows 2000 startup and logon process. The client uses LDAP during the domain controller locator process to get the domain controller it will use. LDAP is also used to find the applicable group policy objects for the computer or user. Finally, LDAP is used to locate the appropriate certificates for the client during certificate auto enrollment., 142681=The last part of the startup process is for the client to perform its name update in the DNS database. The Windows 2000 dynamic DNS update is based on RFC 2136. This process is based on RFC 2136., 78229=The process that allows users to access resources does not start when the user logs on to the system, but begins well before that when the system is started. In a Windows 2000 domain environment, the computer needs to establish itself as a valid member of a domain before users will be able to logon to that system and access other resources on the network., 99970=ICMP Echo Reply: To 10.00.00.24 From 10.00.00.22 10.0.0.22 10.0.0.24, 42950=How clients connect to the network with Windows 2000 Dynamic Host Configuration Protocol (DHCP), Automatic Private Internet Protocol (IP) addressing, and static addressing., 53572=Windows 2000 Resource Kit: Windows 2000 DNS, TCP/IP Core Networking Guide}",
    "textBeforeTable": "The following table shows the communication sequence for this process. The client has to bind to an interface first before it can call its procedures. If the bind process was successful, it can send a request to the End Point Mapper, in which it includes the UUID of the target interface. The End Point Mapper sends back the port number the client can use for the communication. Most of the RPC interfaces use dynamic ports for the network communication. In this case it is necessary to involve a specific interface, called the End Point Mapper. The End Point Mapper is always listening on port 135 for TCP/IP and the End Point Mapper's UUID is E1AF8308-5D1F-11C9-91A4- 08002B14A0FA. RPC are independent from the low-level transport protocol. Microsoft RPC (MSRPC) can be layered on top of several different transport protocols such as TCP/IP, Internetwork Packet Exchange/Sequenced Packet Exchange (IPX/SPX), or NetBIOS Enhanced User Interface (NetBEUI). + MSRPC: Presentation Context List MSRPC: Assoc Group Identifier = 0 (0x0) MSRPC: Max Recv Frag Size = 5840 (0x16D0) MSRPC: Max Trans Frag Size = 5840 (0x16D0) MSRPC: Call Identifier = 1 (0x1) MSRPC: Authentication Length = 0 (0x0) MSRPC: Fragment Length = 72 (0x48) MSRPC: Packed Data Representation + MSRPC: Flags 1 = 3 (0x3) MSRPC: Packet Type = Bind MSRPC: Version (Minor) = 0 (0x0) MSRPC: Version = 5 (0x5) assoc grp 0x0 xmit 0x16D0 recv 0x16D0 MSRPC: c/o RPC Bind: UUID 12345678-1234-ABCD-EF00-01234567CFFB call 0x1  An example for an RPC call is: The",
    "textAfterTable": "The following hierarchy is used by systems in the domain to perform time synchronization: All client desktops nominate as their in-bound time partner their authenticating domain controller. All member servers follow the same process as client desktops. All domain controllers in a domain nominate the primary domain controller (PDC) Operations Masters as their in-bound time partner. PDC Operations Masters follow the hierarchy of domains in the selection of their in-bound time partner. Note: Operations Masters are described in Chapter 7 of the Distributed Systems Guide in the Windows 2000 Server Resource Kit. For more information, see: 216734 for a description of the time sync process and how to set up an authoritative time source RFC: 1769, 2030 Windows 2000 Domain Authentication Methods Windows 2000 supports two different authentication methods for domain logons: Kerberos and NTLM. The use of Kerberos as the authentication protocol for Windows 2000 changes the default Windows authentication protocol from NTLM to a protocol that is based on Internet Standards. The default authentication protocol in Windows 2000 is based on MIT's Kerberos version 5, outlined in RFC 1510. Using Kerberos for authentication fundamentally changes the way security information is exchanged between clients, servers, and domain controllers in the Windows network. With Kerberos, the client requests what is called a session ticket from the KDC. The session ticket contains information that the server can use to validate the client",
    "hasKeyColumn": true,
    "keyColumnIndex": 0,
    "headerRowIndex": 0
}