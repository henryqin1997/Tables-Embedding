{
    "relation": [
        [
            "",
            "45",
            "46",
            "47",
            "48",
            "49",
            "50",
            "",
            "",
            "",
            "51",
            "52",
            "53",
            "\u2026",
            "64",
            "65",
            "66",
            "67",
            "68",
            "69",
            "70",
            "71",
            "72",
            "73",
            "74"
        ],
        [
            "",
            "45",
            "46",
            "47",
            "",
            "",
            "",
            "48",
            "49",
            "50",
            "51",
            "52",
            "53",
            "\u2026",
            "64",
            "65",
            "66",
            "",
            "",
            "",
            "",
            "",
            "67",
            "68",
            "69"
        ],
        [
            "",
            "$charset = isset($_POST['charset']) ? $_POST['charset'] : '';",
            "",
            "// These three are stripslashed here so that they can be properly escaped after mb_convert_encoding()",
            "$title = isset($_POST['title']) ? stripslashes($_POST['title']) : '';",
            "$excerpt = isset($_POST['excerpt']) ? stripslashes($_POST['excerpt']) : '';",
            "$blog_name = isset($_POST['blog_name']) ? stripslashes($_POST['blog_name']) : '';",
            "$title = isset($_POST['title']) ? wp_unslash( $_POST['title'] ) : '';",
            "$excerpt = isset($_POST['excerpt']) ? wp_unslash( $_POST['excerpt'] ) : '';",
            "$blog_name = isset($_POST['blog_name']) ? wp_unslash( $_POST['blog_name'] ) : '';",
            "",
            "if ($charset)",
            "$charset = str_replace( array(',', ' '), '', strtoupper( trim($charset) ) );",
            "",
            "$blog_name = mb_convert_encoding($blog_name, get_option('blog_charset'), $charset);",
            "}",
            "",
            "// Now that mb_convert_encoding() has been given a swing, we need to escape these three",
            "$title = $wpdb->escape($title);",
            "$excerpt = $wpdb->escape($excerpt);",
            "$blog_name = $wpdb->escape($blog_name);",
            "",
            "if ( is_single() || is_page() )",
            "$tb_id = $posts[0]->ID;",
            ""
        ]
    ],
    "pageTitle": "21767.8.diff on Ticket #21767 \u2013 Attachment \u2013 WordPress Trac",
    "title": "",
    "url": "https://core.trac.wordpress.org/attachment/ticket/21767/21767.8.diff",
    "hasHeader": true,
    "headerPosition": "FIRST_COLUMN",
    "tableType": "RELATION",
    "tableNum": 25,
    "s3Link": "common-crawl/crawl-data/CC-MAIN-2015-32/segments/1438042988311.72/warc/CC-MAIN-20150728002308-00285-ip-10-236-191-2.ec2.internal.warc.gz",
    "recordEndOffset": 871992271,
    "recordOffset": 871918077,
    "tableOrientation": "VERTICAL",
    "textBeforeTable": "wp-comments-post.php Remove all escape() calls from xmlrpc. Remove more stripslashes() calls elsewhere. Use wp_kses_post() instead of wp_filter_post_kses(). File 21767.8.diff, 139.4 KB (added by ryan, 2 years ago) Ticket #21767: 21767.8.diff Back to Ticket #21767 Context Navigation Notifications Login Search: Create a New Ticket Trac Timeline Browse Source Components Tickets Handbook Blog Make WordPress Core Download WordPress Hosting Blog About Get Involved Documentation Forums",
    "textAfterTable": "56 \u00a0 55 57 // If the user is logged in\u00a0 56 58 $user = wp_get_current_user();\u00a0 \u2026 \u2026 \u00a0 61 63 \u00a0 \u00a0 \u00a0 \u00a0 $comment_author_email = $wpdb->escape($user->user_email);\u00a0 62 64 \u00a0 \u00a0 \u00a0 \u00a0 $comment_author_url\u00a0 \u00a0= $wpdb->escape($user->user_url);\u00a0 63 65 \u00a0 \u00a0 \u00a0 \u00a0 if ( current_user_can('unfiltered_html') ) {\u00a0 64 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if ( wp_create_nonce('unfiltered-html-comment_' . $comment_post_ID) != $ _POST['_wp_unfiltered_html_comment'] ) {\u00a0 \u00a0 66 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 if ( wp_create_nonce('unfiltered-html-comment_' . $comment_post_ID) != $ post_data['_wp_unfiltered_html_comment'] ) {\u00a0 65 67 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 kses_remove_filters(); // start with a clean slate\u00a0 66 68 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 kses_init_filters(); // set up the filters\u00a0 67 69 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\u00a0 \u2026 \u2026 \u00a0 83 85 if ( '' == $comment_content )\u00a0 84 86 \u00a0 \u00a0 \u00a0 \u00a0 wp_die( __('<strong>ERROR</strong>: please type a comment.') );\u00a0 85 87 \u00a0 86 \u00a0 $comment_parent = isset($ _POST['comment_parent']) ? absint($_POST['comment_parent']) : 0;\u00a0",
    "hasKeyColumn": true,
    "keyColumnIndex": 17,
    "headerRowIndex": 0
}