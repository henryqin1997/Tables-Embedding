{
    "relation": [
        [
            "",
            "%pretrans",
            "%pre",
            "%post",
            "%preun",
            "%postun",
            "%posttrans"
        ],
        [
            "install",
            "$1 == 0",
            "$1 == 1",
            "$1 == 1",
            "(N/A)",
            "(N/A)",
            "$1 == 0"
        ],
        [
            "upgrade",
            "$1 == 0",
            "$1 == 2",
            "$1 == 2",
            "$1 == 1",
            "$1 == 1",
            "$1 == 0"
        ],
        [
            "uninstall",
            "(N/A)",
            "(N/A)",
            "(N/A)",
            "$1 == 0",
            "$1 == 0",
            "(N/A)"
        ]
    ],
    "pageTitle": "Packaging:ScriptletSnippets - FedoraProject",
    "title": "",
    "url": "https://fedoraproject.org/w/index.php?title=Packaging:ScriptletSnippets&diff=325368&oldid=157064",
    "hasHeader": true,
    "headerPosition": "FIRST_ROW",
    "tableType": "RELATION",
    "tableNum": 2,
    "s3Link": "common-crawl/crawl-data/CC-MAIN-2015-32/segments/1438042989018.48/warc/CC-MAIN-20150728002309-00118-ip-10-236-191-2.ec2.internal.warc.gz",
    "recordEndOffset": 851250127,
    "recordOffset": 851220096,
    "tableOrientation": "HORIZONTAL",
    "TableContextTimeStampAfterTable": "{130535=Copyright \u00a9 2015 Red Hat, Inc. and others. All Rights Reserved. For comments or queries, please contact us.}",
    "textBeforeTable": "The scriptlets also take an argument, passed into them by the controlling rpmbuild process. This argument, accessed via $1 is the number of packages of this name which will be left on the system when the action completes, except for\u00a0%pretrans and\u00a0%posttrans which are always run with $1 as 0 (%pretrans and\u00a0%posttrans are available in rpm 4.4 and later). So for the common case of install, upgrade, and uninstall we have: The basic syntax is similar to the\u00a0%build,\u00a0%install, and other sections of the rpm spec file. The scripts support a special flag, -p which allows the scriptlet to invoke a single program directly rather than having to spawn a shell to invoke the programs. (ie:\u00a0%post -p /sbin/ldconfig) Syntax In Fedora, you can assume that the default shell (/bin/sh) is bash. Thus, all scriptlets can safely assume that if they are running in shell code, they are running within bash. Default Shell Contents: Rpm spec files have several sections which allow packages to run code on installation and removal. These scriptlets are mostly used to update the running system with information from the package. This page offers a quick overview of the RPM scriptlets and a number of common recipes for scriptlets in packages. For a more complete treatment of scriptlets, please see the Maximum RPM book . RPM scriptlet recipes",
    "textAfterTable": "Note that these values will vary if there are multiple versions of the same package installed (This mostly occurs with parallel installable packages such as the kernel and multilib packages. However, it can also occur when errors prevent a package upgrade from completing.) So it is a good idea to use this construct:  %pre if [ $1 -gt 1 ]\u00a0; then fi ...for\u00a0%pre and\u00a0%post scripts rather than checking that it equals 2. Except in some really exceptional cases (if any), we want all scriptlets to exit with the zero exit status. Because rpm in its default configuration does not at the moment execute shell scriptlets with the -e argument to the shell, excluding explicit exit calls (frowned upon with a non-zero argument!), the exit status of the last command in a scriptlet determines its exit status. Most commands in the snippets in this document have a \"||\u00a0:\" appended to them, which is a generic trick to force the zero exit status for those commands whether they worked or not. Usually the most important bit is to apply this to the last command executed in a scriptlet, or to add a separate command such as plain \":\" or \"exit 0\" as the last one in a scriptlet. Note that depending on the case, other error checking/prevention measures may be more appropriate, as well as running some commands only if we saw a previous command in the scriptlet which is a must prerequisite to succeed. Non-zero",
    "hasKeyColumn": false,
    "keyColumnIndex": -1,
    "headerRowIndex": 0
}